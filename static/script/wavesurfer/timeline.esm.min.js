class t{constructor(){this.listeners={}}on(t,e){return this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),()=>this.un(t,e)}once(t,e){const i=this.on(t,e),s=this.on(t,()=>{i(),s()});return i}un(t,e){this.listeners[t]&&(e?this.listeners[t].delete(e):delete this.listeners[t])}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach(t=>t(...e))}}class e extends t{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(t=>t())}}const i={height:20,formatTimeCallback:t=>1<t/60?Math.floor(t/60)+":"+((t=Math.round(t%60))<10?"0":"")+t:""+Math.round(1e3*t)/1e3};class n extends e{constructor(t){super(t||{}),this.options=Object.assign({},i,t),this.timelineWrapper=this.initTimelineWrapper()}static create(t){return new n(t)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");var t=null!=(t=this.options.container)?t:this.wavesurfer.getWrapper();this.options.insertPosition?(t.firstElementChild||t).insertAdjacentElement(this.options.insertPosition,this.timelineWrapper):t.appendChild(this.timelineWrapper),this.options.duration?this.initTimeline(this.options.duration):this.subscriptions.push(this.wavesurfer.on("redraw",()=>{var t;this.initTimeline((null==(t=this.wavesurfer)?void 0:t.getDuration())||0)}))}destroy(){this.timelineWrapper.remove(),super.destroy()}initTimelineWrapper(){var t=document.createElement("div");return t.setAttribute("part","timeline"),t}defaultTimeInterval(t){return 25<=t?1:25<=5*t?5:25<=15*t?15:60*Math.ceil(.5/t)}defaultPrimaryLabelInterval(t){return 25<=t?10:25<=5*t?6:4}defaultSecondaryLabelInterval(t){return 25<=t?5:2}initTimeline(e){var i,s,n=this.timelineWrapper.scrollWidth/e,r=null!=(t=this.options.timeInterval)?t:this.defaultTimeInterval(n),o=null!=(i=this.options.primaryLabelInterval)?i:this.defaultPrimaryLabelInterval(n),l=null!=(s=this.options.secondaryLabelInterval)?s:this.defaultSecondaryLabelInterval(n),t="beforebegin"===this.options.insertPosition,a=document.createElement("div");if(a.setAttribute("style",`
      height: ${this.options.height}px;
      overflow: hidden;
      font-size: ${this.options.height/2}px;
      white-space: nowrap;
      position: relative;
    `),t){const e="\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        z-index: 2;\n      ";a.setAttribute("style",a.getAttribute("style")+"\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        z-index: 2;\n      ")}"string"==typeof this.options.style?a.setAttribute("style",a.getAttribute("style")+this.options.style):"object"==typeof this.options.style&&Object.assign(a.style,this.options.style);var h=document.createElement("div");h.setAttribute("part","timeline-notch"),h.setAttribute("style",`
      width: 0;
      height: 50%;
      display: flex;
      flex-direction: column;
      justify-content: ${t?"flex-start":"flex-end"};
      ${t?"top: 0;":"bottom: 0;"}
      overflow: visible;
      border-left: 1px solid currentColor;
      opacity: 0.25;
      position: absolute;
      z-index: 1;
    `);for(let t=0;t<e;t+=r){const e=h.cloneNode(),i=Math.round(100*t)/100%o==0,s=Math.round(100*t)/100%l==0;(i||s)&&(e.style.height="100%",e.style.textIndent="3px",e.textContent=this.options.formatTimeCallback(t),i)&&(e.style.opacity="1"),e.style.left=t*n+"px",a.appendChild(e)}this.timelineWrapper.innerHTML="",this.timelineWrapper.appendChild(a),this.emit("ready")}}export{n as default};